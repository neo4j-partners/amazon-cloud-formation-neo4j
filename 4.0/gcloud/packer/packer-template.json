{
  "variables": {
    "neo4j_version": "1:4.0.10",
    "neo4j_edition": "enterprise",
    "zone": "us-central1-a",
    "gcp_service_account_credentials_file": "./packer-sa.json",
    "gcp_base_image": "ubuntu-1804-bionic-v20190617",
    "apoc_jar": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases/download/4.0.0.13/apoc-4.0.0.13-all.jar"
  },
  "builders": [
    {
      "type": "googlecompute",
      "account_file": "{{user `gcp_service_account_credentials_file`}}",
      "project_id": "launcher-development-191917",
      "source_image": "{{user `gcp_base_image`}}",
      "ssh_username": "ubuntu",
      "zone": "{{user `zone`}}",
      "image_family": "neo4j",
      "image_name": "neo4j-{{user `neo4j_edition` | clean_image_name}}-{{user `neo4j_version` | clean_image_name}}-apoc",
      "image_labels": {
        "neo4j_package": "{{user `neo4j_version` | clean_image_name}}",
        "neo4j_edition": "{{user `neo4j_edition` | clean_image_name}}",
        "build_date": "{{isotime \"2006-01-02T03_04_05Z\" | clean_image_name}}"
      },
      "tags": ["neo4j"]
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "./neo4j.conf",
      "destination": "/home/ubuntu/neo4j.conf"
    },
    {
      "type": "file",
      "source": "./pre-neo4j.sh",
      "destination": "/home/ubuntu/pre-neo4j.sh"
    },
    {
      "type": "file",
      "source": "../../licensing",
      "destination": "/home/ubuntu"
    },
    {
      "type": "shell",
      "script": "./install-neo4j.sh",
      "environment_vars": [
        "neo4j_version={{ user `neo4j_version` }}",
        "neo4j_edition={{ user `neo4j_edition` }}",
        "apoc_jar={{ user `apoc_jar` }}"
      ]
    }
  ]
}